import { useState, useEffect } from "react";
import styles from "./Preloader.module.scss";

const imagesToPreload = [
  "/images/landing/smallMountains.png",
  "/images/landing/bigMountain.png",
  "/images/landing/tree.png",
  "/images/landing/cloud.png",
  "/images/landing/sun.png",
  "/svgs/landing/registerBtn.svg",
  "/svgs/logo.svg",
  "/svgs/landing/sketchBackground.svg",
  "/images/landing/v.png",
  "/videos/ink-spread-2.gif",
];

interface PreloaderProps {
  onEnter: () => void;
}

export default function Preloader({ onEnter }: PreloaderProps) {
  const [progress, setProgress] = useState(0);

  useEffect(() => {
    let loadedImages = 0;

    const preloadImage = (src: string) => {
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.src = src;
        img.onload = () => {
          loadedImages++;
          setProgress((loadedImages / imagesToPreload.length) * 100);
          resolve(img);
        };
        img.onerror = reject;
      });
    };

    Promise.all(imagesToPreload.map(preloadImage))
      .then(() => {
        onEnter();
      })
      .catch((err) => {
        console.error("Error preloading images:", err);
        onEnter();
      });
  }, []);

  return (
    <div className={styles.preloader}>
      <div className={styles.loadingContainer}>
        <svg
          className={styles.loader}
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M95.0892 34.648C83.7592 17.304 67.2772 27.195 67.2772 27.195H67.2762L66.5892 31.057L64.0392 32.529C61.9312 33.746 59.3632 33.633 57.2612 32.405C57.2132 32.377 57.1662 32.35 57.1182 32.322C55.0142 31.118 53.6462 28.953 53.6462 26.529V23.583L56.6472 21.058H56.6422C47.6042 6.979 58.9222 0.697998 58.9222 0.697998C38.2362 1.838 38.5612 21.058 38.5612 21.058L41.5622 23.583V26.531C41.5622 28.955 40.1942 31.119 38.0912 32.324C38.0442 32.351 37.9972 32.378 37.9502 32.406C35.8482 33.634 33.2802 33.747 31.1712 32.53L28.6182 31.056L27.9312 27.194L27.9272 27.198C11.2172 27.985 11.4362 15.043 11.4362 15.043C2.08119 33.526 18.8852 42.854 18.8882 42.856L22.5762 41.52L25.1092 42.982C27.2132 44.197 28.4022 46.47 28.3902 48.899C28.3902 48.929 28.3902 48.959 28.3902 48.989C28.3902 49.021 28.3902 49.053 28.3902 49.085C28.4022 51.514 27.2132 53.788 25.1092 55.003L22.5752 56.466L18.8872 55.13L18.8882 55.137C11.2142 69.999 0.117188 63.339 0.117188 63.339C11.4472 80.683 27.9272 70.793 27.9302 70.791L28.6172 66.93L34.8492 63.332C35.8452 64.218 36.9312 65.003 38.0942 65.669C40.1962 66.873 41.5612 69.037 41.5612 71.459V74.402L38.5602 76.928H38.5652C47.6032 91.007 36.2852 97.288 36.2852 97.288C56.9712 96.148 56.6452 76.928 56.6452 76.928L53.6442 74.402V71.461C53.6442 69.039 55.0102 66.874 57.1122 65.67C57.1472 65.65 57.1832 65.629 57.2182 65.609C59.3442 64.373 61.9392 64.266 64.0572 65.517L66.5522 66.99L67.2742 70.79L67.2772 70.786C83.9882 69.999 83.7692 82.941 83.7692 82.941C93.1242 64.457 76.3182 55.129 76.3182 55.129L76.3172 55.128L72.6292 56.464L70.0992 55.003C67.9952 53.788 66.8062 51.515 66.8182 49.085C66.8182 49.052 66.8182 49.02 66.8182 48.987C66.8182 48.956 66.8182 48.926 66.8182 48.895C66.8072 46.466 67.9952 44.192 70.0992 42.978L72.6282 41.518L76.3162 42.854L76.3132 42.85C83.9892 27.987 95.0892 34.648 95.0892 34.648ZM47.6052 53.76C44.9752 53.76 42.8372 51.622 42.8372 48.992C42.8372 46.362 44.9762 44.224 47.6052 44.224C50.2342 44.224 52.3732 46.363 52.3732 48.992C52.3732 51.622 50.2352 53.76 47.6052 53.76Z"
            fill="#3C4240"
          />
          <path
            d="M70.109 42.985L72.628 41.528L74.275 42.114L76.319 42.858C80.358 35.017 85.364 33.163 89.182 33.163C92.604 33.163 95.091 34.652 95.091 34.652C88.866 25.116 81.072 23.817 75.322 24.577C70.617 25.195 67.275 27.191 67.275 27.191L66.594 31.056L64.044 32.53C61.937 33.75 59.371 33.639 57.264 32.403C57.216 32.371 57.169 32.355 57.121 32.324C55.014 31.12 53.652 28.95 53.652 26.526V23.58L56.646 21.061C54.064 17.038 53.145 13.663 53.145 10.875C53.145 3.90495 58.927 0.704956 58.927 0.704956C50.531 1.16496 45.589 4.61795 42.69 8.54595C38.445 14.281 38.556 21.06 38.556 21.06L41.566 23.579V26.526C41.566 28.95 40.204 31.12 38.097 32.324C38.049 32.356 38.002 32.372 37.954 32.403C37.701 32.545 37.463 32.672 37.194 32.783C35.261 33.638 33.044 33.607 31.174 32.53L28.624 31.056L27.927 27.207C11.215 27.983 11.436 15.041 11.436 15.041C2.09 33.527 18.881 42.858 18.897 42.858L22.572 41.527L25.107 42.984C27.214 44.204 28.402 46.469 28.386 48.893V49.083C28.402 51.522 27.214 53.788 25.107 55.007L22.572 56.464L18.897 55.133C14.842 62.975 9.83601 64.828 6.01801 64.828C2.59601 64.828 0.125 63.339 0.125 63.339C5.606 71.719 12.275 73.7459 17.709 73.588C23.523 73.445 27.926 70.8 27.926 70.8L28.623 66.935L34.848 63.339C35.846 64.226 36.939 65.002 38.095 65.668C38.158 65.7 38.222 65.731 38.269 65.779C40.281 66.999 41.564 69.105 41.564 71.466V74.4129L38.57 76.932C40.027 79.197 40.946 81.272 41.485 83.126C44.257 92.868 36.289 97.2879 36.289 97.2879C56.977 96.1469 56.645 76.932 56.645 76.932L54.347 75L53.65 74.414V71.4669C53.65 69.0429 55.012 66.873 57.119 65.669C57.151 65.653 57.182 65.637 57.214 65.606C59.21 64.45 61.602 64.2909 63.63 65.3049C63.773 65.3689 63.915 65.4479 64.058 65.5269L66.561 67L67.274 70.7859C83.986 70.0099 83.765 82.952 83.765 82.952C93.127 64.466 76.32 55.135 76.32 55.135L72.629 56.466L70.11 55.009C70.047 54.977 69.999 54.946 69.952 54.898C67.94 53.662 66.815 51.461 66.815 49.085V48.895C66.814 46.47 68.002 44.189 70.109 42.985ZM47.599 53.757C46.538 53.757 45.556 53.408 44.763 52.822C43.591 51.951 42.83 50.557 42.83 48.988C42.83 46.533 44.699 44.505 47.091 44.252C47.265 44.236 47.424 44.22 47.598 44.22C50.228 44.22 52.366 46.359 52.366 48.988C52.367 51.619 50.229 53.757 47.599 53.757Z"
            fill="#3C4240"
          />
          <path
            d="M75.323 24.578C70.618 25.196 67.276 27.192 67.276 27.192L66.595 31.057L64.045 32.531C61.938 33.751 59.372 33.64 57.265 32.404C57.217 32.372 57.17 32.356 57.122 32.325C55.015 31.121 53.653 28.951 53.653 26.527V23.58L56.647 21.061C54.065 17.038 53.146 13.663 53.146 10.875C53.146 3.90495 58.928 0.704956 58.928 0.704956C38.239 1.84596 38.556 21.061 38.556 21.061L41.566 23.58V26.527C41.566 28.951 40.204 31.121 38.097 32.325C38.049 32.357 38.002 32.373 37.954 32.404C35.847 33.64 33.281 33.75 31.174 32.531L28.624 31.057L27.927 27.208C11.215 27.984 11.436 15.042 11.436 15.042C2.09 33.528 18.881 42.859 18.897 42.859L22.572 41.528L25.107 42.985C27.214 44.205 28.402 46.47 28.386 48.894V49.084C28.402 51.523 27.214 53.789 25.107 55.008L22.572 56.465L18.897 55.134C14.842 62.976 9.83601 64.8289 6.01801 64.8289C2.59601 64.8289 0.125 63.34 0.125 63.34C11.451 80.686 27.926 70.8009 27.926 70.8009L28.623 66.936L34.848 63.34C35.846 64.227 36.939 65.003 38.095 65.669C40.202 66.873 41.564 69.0429 41.564 71.4669V74.414L38.57 76.933C40.027 79.198 40.946 81.273 41.485 83.127C46.126 80.988 50.451 78.248 54.348 75.001L53.651 74.4149V71.468C53.651 69.044 55.013 66.874 57.12 65.67C57.152 65.654 57.183 65.6379 57.215 65.6069C59.211 64.451 61.603 64.292 63.631 65.306C66.086 62.09 68.209 58.59 69.952 54.898C67.94 53.662 66.815 51.461 66.815 49.085V48.895C66.815 46.471 68.003 44.19 70.11 42.986L72.629 41.529L74.276 42.115C75.116 38.155 75.559 34.052 75.559 29.838C75.561 28.063 75.481 26.305 75.323 24.578ZM47.601 53.757C44.971 53.757 42.833 51.618 42.833 48.989C42.833 46.359 44.972 44.221 47.601 44.221C50.231 44.221 52.369 46.36 52.369 48.989C52.369 51.619 50.231 53.757 47.601 53.757Z"
            fill="#414745"
          />
          <path
            d="M42.831 48.989C42.831 50.557 43.591 51.951 44.764 52.823C43.148 57.433 40.946 61.789 38.269 65.781C38.222 65.733 38.158 65.702 38.095 65.67C36.939 65.005 35.846 64.228 34.848 63.341L28.623 66.937L27.926 70.802C27.926 70.802 11.451 80.687 0.125 63.341C0.125 63.341 2.59601 64.83 6.01801 64.83C9.83601 64.83 14.841 62.977 18.897 55.135L22.572 56.466L25.107 55.009C27.214 53.789 28.402 51.524 28.386 49.085V48.895C28.402 46.471 27.214 44.206 25.107 42.986L22.572 41.529L18.897 42.86C18.881 42.86 2.09 33.53 11.436 15.043C11.436 15.043 11.214 27.985 27.927 27.209L28.624 31.058L31.174 32.532C33.281 33.752 35.847 33.641 37.954 32.405C38.002 32.373 38.049 32.357 38.097 32.326C40.204 31.122 41.566 28.952 41.566 26.528V23.58L38.556 21.061C38.556 21.061 38.445 14.281 42.69 8.547C46.175 16.056 48.124 24.42 48.124 33.243C48.124 36.997 47.775 40.688 47.094 44.252C44.7 44.506 42.831 46.534 42.831 48.989Z"
            fill="#474C4A"
          />
          <path
            d="M37.193 32.784C36.401 48.973 29.035 63.452 17.709 73.59C12.276 73.748 5.606 71.721 0.125 63.341C0.125 63.341 2.59601 64.83 6.01801 64.83C9.83601 64.83 14.841 62.977 18.897 55.135L22.572 56.466L25.107 55.009C27.214 53.789 28.402 51.524 28.386 49.085V48.895C28.402 46.471 27.214 44.206 25.107 42.986L22.572 41.529L18.897 42.86C18.881 42.86 2.09 33.53 11.436 15.043C11.436 15.043 11.214 27.985 27.927 27.209L28.624 31.058L31.174 32.532C33.042 33.607 35.26 33.639 37.193 32.784Z"
            fill="#4A4F4D"
          />
          <path
            d="M54.096 21.0591L51.125 23.5841H53.57L56.642 21.0591H54.096Z"
            fill="#565B59"
          />
          <path
            d="M56.6488 21.0561H54.1078C54.1078 21.0561 50.3828 17.8361 50.3828 10.2311C50.3828 6.33206 52.3618 3.24706 53.9908 1.38506C55.4848 1.03606 57.1138 0.803055 58.9178 0.706055C58.9178 0.706055 47.6088 6.97305 56.6488 21.0561Z"
            fill="#565B59"
          />
          <path
            d="M41.1095 76.932L44.0795 74.406H41.6345L38.5625 76.932H41.1095Z"
            fill="#565B59"
          />
          <path
            d="M38.5581 76.934H41.0991C41.0991 76.934 44.8241 80.154 44.8241 87.759C44.8241 91.658 42.8451 94.743 41.2161 96.6049C39.7221 96.954 38.0931 97.187 36.2891 97.284C36.2891 97.284 47.5981 91.018 38.5581 76.934Z"
            fill="#565B59"
          />
          <path
            d="M75.047 40.653L71.375 39.343L72.597 41.461L76.32 42.858L75.047 40.653Z"
            fill="#565B59"
          />
          <path
            d="M76.3257 42.86L75.0547 40.659C75.0547 40.659 75.9817 35.823 82.5667 32.021C85.9437 30.071 89.6047 30.243 92.0317 30.723C93.0807 31.842 94.0977 33.137 95.0837 34.651C95.0837 34.651 84.0027 27.989 76.3257 42.86Z"
            fill="#565B59"
          />
          <path
            d="M20.1636 57.337L23.8366 58.647L22.6136 56.53L18.8906 55.132L20.1636 57.337Z"
            fill="#565B59"
          />
          <path
            d="M18.883 55.131L20.154 57.332C20.154 57.332 19.227 62.168 12.642 65.97C9.265 67.92 5.604 67.748 3.177 67.268C2.128 66.149 1.111 64.854 0.125 63.34C0.125 63.34 11.207 70.001 18.883 55.131Z"
            fill="#565B59"
          />
          <path
            d="M26.6562 29.401L27.3582 33.236L28.5802 31.119L27.9292 27.196L26.6562 29.401Z"
            fill="#565B59"
          />
          <path
            d="M27.9275 27.192L26.6565 29.393C26.6565 29.393 22.0055 31.008 15.4195 27.206C12.0425 25.256 10.3605 22 9.5625 19.658C10.0075 18.19 10.6195 16.662 11.4385 15.051C11.4385 15.051 11.2115 27.979 27.9275 27.192Z"
            fill="#565B59"
          />
          <path
            d="M68.549 68.59L67.848 64.754L66.625 66.872L67.276 70.795L68.549 68.59Z"
            fill="#565B59"
          />
          <path
            d="M67.2734 70.7991L68.5444 68.5981C68.5444 68.5981 73.1955 66.9831 79.7805 70.7851C83.1575 72.7351 84.8395 75.99 85.6375 78.333C85.1925 79.801 84.5794 81.3291 83.7614 82.9401C83.7614 82.9401 83.9894 70.0121 67.2734 70.7991Z"
            fill="#565B59"
          />
        </svg>

        <div className={styles.percentage}>{Math.round(progress)}%</div>
      </div>
    </div>
  );
}
